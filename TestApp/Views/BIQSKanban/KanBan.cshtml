
@{
    ViewBag.Title = "KanBan";
    Layout = null;
}

<link href="~/Scripts/layui/css/layui.css" rel="stylesheet" />
<script src="~/Scripts/layui/layui.js"></script>

<link href="~/Scripts/JQGrid/css/ui.jqgrid.css" rel="stylesheet" />
<link href="~/Content/jquery-ui-1.12.1.custom/jquery-ui.css" rel="stylesheet" />
<script src="~/Scripts/JQGrid/js/jquery-1.11.0.min.js"></script>
<script src="~/Scripts/JQGrid/js/jquery.jqGrid.js"></script>
<script src="~/Content/jquery-ui-1.12.1.custom/jquery-ui.js"></script>
<script src="~/Scripts/JQGrid/js/i18n/grid.locale-cn.js"></script>
<script src="~/Scripts/JQGrid/jqGridexpand.js"></script>
<script src="~/Scripts/FrameWork.js"></script>

<script src="~/Scripts/Validator.js"></script>


<script src="~/Scripts/echarts/echarts.js"></script>
<script src="~/Scripts/echarts/theme/macarons.js"></script>

<link href="~/Scripts/jquery.triangle/css/index.css" rel="stylesheet" />

<div>
    <ul class="layui-nav" lay-filter="">
        <li class="layui-nav-item"><a href=""><b>上海福耀BIQS看板</b></a></li>
    </ul>
</div>
<br>
<div class="layui-container" style="width:100%">
    <div class="layui-row layui-col-space10">
        <div class="layui-col-lg12">
            <div class="layui-collapse" lay-accordion>
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">快速反应看板</h2>
                    <div id="acc1" class="layui-colla-content layui-show">
                        <div class="layui-row layui-col-space10">
                            <div class="layui-col-lg12">
                                
                                    <div id="RapidByResponse" style="width: auto;height:400px"></div>
                                
                            </div>
                            <div class="layui-col-lg4">
                                  <div id="RapidByDepart" style="width: auto;height:400px"></div>
                            </div>
                            <div class="layui-col-lg8">
                                <table style="float:left;margin-left:60px">

                                    <tr>
                                        <td>
                                            <div class="main5">
                                                <div id="31" class="triangle31" style="margin-left: 395px;">
                                                    <div class="trian_texta" style="background-color:green">31</div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr style="height:5px"></tr>
                                    <tr>
                                        <td>

                                            <div class="main4">
                                                <div id="28" class="triangle28" style="margin-left: 320px;">
                                                    <div class="trian_texta">28</div>
                                                </div>
                                                <div id="29" class="triangle29">
                                                    <div class="trian_textb">29</div>
                                                </div>
                                                <div id="30" class="triangle30">
                                                    <div class="trian_texta">30</div>
                                                </div>
                                            </div>

                                        </td>
                                    </tr>
                                    <tr style="height:5px"></tr>
                                    <tr>
                                        <td>

                                            <div class="main3">
                                                <div id="none1" class="trianglenone1" style="margin-left: 245px;">

                                                </div>
                                                <div id="none2" class="trianglenone2">

                                                </div>
                                                <div id="none3" class="trianglenone3">

                                                </div>
                                                <div id="none4" class="trianglenone4">

                                                </div>
                                                <div id="none5" class="trianglenone5">

                                                </div>



                                            </div>

                                        </td>
                                    </tr>
                                    <tr style="height:5px"></tr>
                                    <tr>
                                        <td>

                                            <div class="main2">
                                                <div id="21" class="triangle21" style="margin-left: 170px;">
                                                    <div class="trian_texta">21</div>
                                                </div>
                                                <div id="22" class="triangle22">
                                                    <div class="trian_textb">22</div>
                                                </div>
                                                <div id="23" class="triangle23">
                                                    <div class="trian_texta">23</div>
                                                </div>
                                                <div id="24" class="triangle24">
                                                    <div class="trian_textb">24</div>
                                                </div>
                                                <div id="25" class="triangle25">
                                                    <div class="trian_texta">25</div>
                                                </div>
                                                <div id="26" class="triangle26">
                                                    <div class="trian_textb">26</div>
                                                </div>
                                                <div id="27" class="triangle27">
                                                    <div class="trian_texta">27</div>
                                                </div>


                                            </div>

                                        </td>
                                    </tr>
                                    <tr style="height:5px"></tr>
                                    <tr>
                                        <td>

                                            <div class="main2">
                                                <div id="12" class="triangle12" style="margin-left: 95px;">
                                                    <div class="trian_texta">12</div>
                                                </div>
                                                <div id="13" class="triangle13">
                                                    <div class="trian_textb">13</div>
                                                </div>
                                                <div id="14" class="triangle14">
                                                    <div class="trian_texta">14</div>
                                                </div>
                                                <div id="15" class="triangle15">
                                                    <div class="trian_textb">15</div>
                                                </div>
                                                <div id="16" class="triangle16">
                                                    <div class="trian_texta">16</div>
                                                </div>
                                                <div id="17" class="triangle17">
                                                    <div class="trian_textb">17</div>
                                                </div>
                                                <div id="18" class="triangle18">
                                                    <div class="trian_texta">18</div>
                                                </div>
                                                <div id="19" class="triangle19">
                                                    <div class="trian_textb">19</div>
                                                </div>
                                                <div id="20" class="triangle20">
                                                    <div class="trian_texta">20</div>
                                                </div>

                                            </div>

                                        </td>
                                    </tr>
                                    <tr style="height:5px"></tr>
                                    <tr>
                                        <td>
                                            <div class="main1">
                                                <div id="1" class="triangle1" style="margin-left: 20px;">
                                                    <div class="trian_texta">1</div>
                                                </div>
                                                <div id="2" class="triangle2">
                                                    <div class="trian_textb">2</div>
                                                </div>
                                                <div id="3" class="triangle3">
                                                    <div class="trian_texta">3</div>
                                                </div>
                                                <div id="4" class="triangle4">
                                                    <div class="trian_textb">4</div>
                                                </div>
                                                <div id="5" class="triangle5">
                                                    <div class="trian_texta">5</div>
                                                </div>
                                                <div id="6" class="triangle6">
                                                    <div class="trian_textb">6</div>
                                                </div>
                                                <div id="7" class="triangle7">
                                                    <div class="trian_texta">7</div>
                                                </div>
                                                <div id="8" class="triangle8">
                                                    <div class="trian_textb">8</div>
                                                </div>
                                                <div id="9" class="triangle9">
                                                    <div class="trian_texta">9</div>
                                                </div>
                                                <div id="10" class="triangle10">
                                                    <div class="trian_textb">10</div>
                                                </div>
                                                <div id="11" class="triangle11">
                                                    <div class="trian_texta">11</div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <table style="float:right;text-align:left">
                                    <tr>
                                        <td>
                                            <div style="background-color:green;width:100px;height:50px">
                                            </div>
                                        </td>
                                        <td>
                                            质量稳定
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style="background-color:yellow;width:100px;height:50px">
                                            </div>
                                        </td>
                                        <td>
                                            内部质量问题
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style="background-color:red;width:100px;height:50px">
                                            </div>
                                        </td>
                                        <td>
                                            外部质量问题
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style="background-color:darkred;width:100px;height:50px">
                                            </div>
                                        </td>
                                        <td>
                                            外部+内部质量问题
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">分层审核看板</h2>
                    <div id="acc2" class="layui-colla-content layui-show">
                        <div class="layui-row layui-col-space10">
                            <div class="layui-col-lg12">
                                <div id="SperateCJWCL" style="width: auto;height:500px"></div>
                            </div>
                            <div class="layui-col-lg6">
                                <div id="ProblemYearCount" style="width:auto;height:400px"></div>
                            </div>
                            <div class="layui-col-lg6">
                                <div id="ProblemResponseCount" style="width:auto;height:400px"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @*<div class="layui-col-lg3">
                <div class="layui-card">
                    <div class="layui-card-header">卡片面板</div>
                    <div class="layui-card-body">
                        test
                    </div>
                </div>
            </div>*@
    </div>
</div>

<script>
    $(document).ready(function () {
        //alert(getBeforeDate(-7));
        SetRapidByResponse();
        SetRapidByDepart();
        QualityP();
        SetSperateCJWCL();
        SetProblemYear();
        SetProblemByResponse();
        //利用js控制手风琴闭合展开
        //$("#acc1").css("class", "layui-colla-content");
        //$("#acc2").css("class", "layui-colla-content");

    });
    layui.use('element', function () {
        var element = layui.element;

    });

    //获取指定日期
    //function getBeforeDate(n) {
    //    var n = n;
    //    var d = new Date();
    //    var year = d.getFullYear();
    //    var mon = d.getMonth() + 1;
    //    var day = d.getDate();
    //    if (day <= n) {
    //        if (mon > 1) {
    //            mon = mon - 1;
    //        } else {
    //            year = year - 1;
    //            mon = 12;
    //        }
    //    }
    //    d.setDate(d.getDate() - n);
    //    year = d.getFullYear();
    //    mon = d.getMonth() + 1;
    //    day = d.getDate();
    //    s = year + "-" + (mon < 10 ? ('0' + mon) : mon) + "-" + (day < 10 ? ('0' + day) : day);
    //    return s;
    //}

    //绑定日期控件elem: '#RapidStartDate', //指定元素
    //layui.use('laydate', function () {
    //    var laydate = layui.laydate;
    //    laydate.render({
    //        elem: '#RapidStartDate'
           
            
           

    //    });
    //    //执行一个laydate实例
    //    laydate.render({
    //        elem: '#RapidEndDate'
           
    //        //value: getBeforeDate(0)
            
    //    });
    //});



    function SetRapidByResponse()
    {
        //console.log($("#RapidStartDate").val());
        //console.log($("#RapidEndDate").val());
        var X = new Array();
        var Y = new Array();
        var Y2 = new Array();
        var Y3 = new Array();
        var durl = encodeURI('@Url.Action("ProblemCompleteCount", "BIQSKanban")');
        $.ajax({
            type: "post",
            url: durl,
            async: false,
            success: function (data) {
                var dataA = new Array();
                dataA = data.split("|");

                X = dataA[2].split(",");
                Y2 = dataA[1].split(",");
                Y = dataA[0].split(",");
                Y3 = dataA[3].split(",");
                //for(var i=0;i<X.length;i++)
                //{
                //    X[i] = X[i] + "月份";
                //}
            }

        });
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('RapidByResponse'));
        // 指定图表的配置项和数据
        var option = {
            color: ['green','#3398DB','red'],
            title: {
                text: '各责任人快反问题汇总'
            },
            tooltip: {},
            legend: {
                data: ['完成问题数','进行中问题数','超期问题数']
            },
            xAxis: {
                splitLine: {
                    show: true,
                    interval: 0,
                },
                data: X
            },
            yAxis: {
                boundaryGap: false
            },
            series: [
                {
                    name: '完成问题数',
                    type: 'bar',
                    data: Y3,
                    itemStyle: { normal: { label: { show: true, position: 'top' } } }
                },
                {
                name: '进行中问题数',
                type: 'bar',
                data: Y,
                itemStyle: { normal: { label: { show: true, position: 'top' } } }
            },
                {
                    name: '超期问题数',
                    type: 'bar',
                    data: Y2,
                    itemStyle: { normal: { label: { show: true, position: 'top' } } }
                }
            ]
        };

        // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
    }

    function SetRapidByDepart() {
        var DataForMyChart2 = new Array();
        var c1=new Array();
        var c2=new Array();
        var durl = encodeURI('@Url.Action("GetPieData", "BIQSKanban")');
        $.ajax({
            type: "post",
            url: durl,
            async: false,
            success: function (data) {
                var xx;
                var dataA = new Array();
                //var i = 0;
                dataA = data.split("|");


                c1 = dataA[0].split(",");
                c2 = dataA[1].split(",");
                c3 = dataA[2].split(",");
                for (var i = 0; i < c1.length; i++)
                {
                    var TempObject = {};
                    TempObject["value"] = parseInt(c1[i]);

                    TempObject["name"] = c3[i]+"(总共:"+c1[i]+"单,已超期:"+c2[i]+"单)";

                    DataForMyChart2.push(TempObject);
                }
            }
        });

        var myChart2 = echarts.init(document.getElementById('RapidByDepart'));
        //饼图
        myChart2.setOption({
            title: {
                text: '各部门问题次数'
            },
            roseType: 'angle',
            series: [
                {
                    name: '访问来源',
                    type: 'pie',
                    radius: '55%',
                    data: DataForMyChart2
                }
            ]
            })
    }

    //质量Q图
    function QualityP()
    {
        $(".triangle1,.triangle3,.triangle5,.triangle7,.triangle9,.triangle11").animate({ marginTop: 0, opacity: 'show' }, { duration: 100 });
        $(".triangle2,.triangle4,.triangle6,.triangle8,.triangle10").animate({ marginTop: 0, opacity: 'show' }, { duration: 100 });

        $(".triangle13,.triangle15,.triangle17,.triangle19").animate({ marginTop: 0, opacity: 'show' }, { duration: 100 });
        $(".triangle12,.triangle14,.triangle16,.triangle18,.triangle20").animate({ marginTop: 0, opacity: 'show' }, { duration: 100 });

        $(".triangle22,.triangle24,.triangle26").animate({ marginTop: 0, opacity: 'show' }, { duration: 100 });
        $(".triangle21,.triangle23,.triangle25,.triangle27").animate({ marginTop: 0, opacity: 'show' }, { duration: 100 });

        $(".trianglenone1,.trianglenone3,.trianglenone5").animate({ marginTop: 0, opacity: 'show' }, { duration: 100 });
        $(".trianglenone2,.trianglenone4").animate({ marginTop: 0, opacity: 'show' }, { duration: 100 });

        $(".triangle28,.triangle30").animate({ marginTop: 0, opacity: 'show' }, { duration: 100 });
        $(".triangle29").animate({ marginTop: 0, opacity: 'show' }, { duration: 100 });

        $(".triangle31").animate({ marginTop: 0, opacity: 'show' }, { duration: 100 });

        var direction = "";
        AjaxJson("/BIQSKanban/QPictureListJson", {}, function (DataJson) {
            console.log(DataJson);
            $.each(DataJson, function (i) {
                console.log(DataJson[i].basicday);
                if (DataJson[i].basicday == "1" || DataJson[i].basicday == "3" || DataJson[i].basicday == "5"
                    || DataJson[i].basicday == "7" || DataJson[i].basicday == "9" || DataJson[i].basicday == "11"
                    || DataJson[i].basicday == "12" || DataJson[i].basicday == "14" || DataJson[i].basicday == "16"
                    || DataJson[i].basicday == "18" || DataJson[i].basicday == "20" || DataJson[i].basicday == "21"
                    || DataJson[i].basicday == "23" || DataJson[i].basicday == "25" || DataJson[i].basicday == "27"
                    || DataJson[i].basicday == "28" || DataJson[i].basicday == "30" || DataJson[i].basicday == "31") {
                    direction = "border-bottom";
                }
                else {
                    direction = "border-top";
                }
                if (DataJson[i].isoverdue == "1") {
                    $("#" + DataJson[i].basicday + "").css(direction, "100px solid rgba(150, 150, 150, 0.8)");
                }
                else {
                    if (DataJson[i].waibunum > 0 && DataJson[i].neinum > 0) {

                        $("#" + DataJson[i].basicday + "").css(direction, "100px solid rgba(139, 0, 0, 0.8)");
                    }
                    else {
                        if (DataJson[i].waibunum > 0) {

                            $("#" + DataJson[i].basicday + "").css(direction, "100px solid rgba(255, 0, 0, 0.8)");
                        }
                        else if (DataJson[i].neinum > 0) {

                            $("#" + DataJson[i].basicday + "").css(direction, "100px solid rgba(255, 255, 0, 0.8)");
                        }
                        else {

                            $("#" + DataJson[i].basicday + "").css(direction, "100px solid rgba(0, 128, 0, 0.8)");
                        }
                    }
                }
            });
        })
        

    }


    //分层审核车间完成率
    function SetSperateCJWCL() {
                var X;
        var Y;
        
        
        var durl = encodeURI('@Url.Action("GetSperateReport", "BIQSKanban")');
        $.ajax({
            type: "post",
            url: durl,
            async: false,
            success: function (data) {
                var dataA = new Array();
                dataA = data.split("|");

                X = dataA[0].split(",");

                Y1 = dataA[1].split(",");

                Y2 = dataA[2].split(",");

                Y3 = dataA[3].split(",");

                Y4 = dataA[4].split(",");

            }

        });
        var myChart = echarts.init(document.getElementById('SperateCJWCL'));

    option = {
        title: {
            text: '分层审核当月车间完成率'
        },
            color: ['#A020F0'],
            tooltip: {
                trigger: 'axis',
                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            legend: {
                data: ['车间完成率']
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '30%',
                containLabel: true
            },
            xAxis: [
                {
                    type: 'category',
                    data: X,
                    axisTick: {
                        alignWithLabel: true
                    },
                    axisLabel: {
                        
                        interval: 0,
                        rotate: 90,
                        margin:8
                    }
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    
                    axisLabel: {
                        show: true,
                        interval: 'auto',
                        
                        formatter: '{value} %'

                    },
                    show: true  
                }
            ],
            series: [
                {
                    name: '车间完成率',
                    type: 'bar',
                    data: Y4,
                    itemStyle: { normal: { label: { show: true, position: 'top', formatter: '{c}%' } } }
                },
            ]
        };

        myChart.setOption(option);
    }

    function SetProblemYear() {
       
            var X = new Array();
            var Y = new Array();
            var Y2 = new Array();
            var Y3 = new Array();
            var durl = encodeURI('@Url.Action("GetProblemActionData", "BIQSKanban")');
        $.ajax({
            type: "post",
            url: durl,
            async: false,
            success: function (data) {
                var dataA = new Array();
                dataA = data.split("|");

                X = dataA[2].split(",");
                Y2 = dataA[1].split(",");
                Y = dataA[0].split(",");
                Y3 = dataA[3].split(",");
                for(var i=0;i<X.length;i++)
                {
                    X[i] = X[i] + "月份";
                }
            }

        });
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('ProblemYearCount'));
        // 指定图表的配置项和数据
        var option = {
            color: ['#3398DB', 'green','#675bba'],
            title: {
                text: '本年度分层审核问题跟踪统计'
            },
            tooltip: {},
            legend: {
                data: ['问题次数','已完成数','完成率']
            },
            xAxis: {
                data: X
            },
            yAxis: [
                {
                    type: 'value',
                    name: '问题次数',
                    //min: 0,
                    //max: 250,
                    //interval: 50,
                    axisLabel: {
                        formatter: '{value} 次'
                    }
                },
                {
                    type: 'value',
                    name: '完成率',
                    //min: 0,
                    //max: 25,
                    //interval: 5,
                    axisLabel: {
                        formatter: '{value} %'
                    }
                }
            ],
            series: [{
                name: '问题次数',
                type: 'bar',
                data: Y,
                itemStyle: { normal: { label: { show: true, position: 'top' } } }
            },
                {
                    name: '已完成数',
                    type: 'bar',
                    yAxisIndex: 0,
                    data: Y2,
                    itemStyle: { normal: { label: { show: true, position: 'top' } } }
                },
            {

                name: '完成率',
                type: 'line',
                yAxisIndex: 1,
                data: Y3,
                itemStyle: { normal: { label: { show: true, position: 'top', formatter: '{c}%' } } }
            },
            ]
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    }

    function SetProblemByResponse()
    {
            var X = new Array();
            var Y = new Array();
            var Y2 = new Array();
            var Y3 = new Array();
            var durl = encodeURI('@Url.Action("GetProblemActionDataByResponse", "BIQSKanban")');
        $.ajax({
            type: "post",
            url: durl,
            async: false,
            success: function (data) {
                var dataA = new Array();
                dataA = data.split("|");

                X = dataA[2].split(",");
                Y2 = dataA[1].split(",");
                Y = dataA[0].split(",");
            }

        });
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('ProblemResponseCount'));
        // 指定图表的配置项和数据
        var option = {
            color: ['#3398DB', 'green'],
            title: {
                text: '当月责任部门问题跟踪统计'
            },
            tooltip: {},
            legend: {
                data: ['问题次数','已完成数']
            },
            //grid: {
            //    left: '3%',
            //    right: '4%',
            //    bottom: '30%',
            //    containLabel: true
            //},
            xAxis: {
                data: X,
                axisLabel: {

                    interval: 0,
                    //rotate: 90,
                    margin: 8
                }
            },
            yAxis: [
                {
                    type: 'value',
                    name: '问题次数',
                    //min: 0,
                    //max: 250,
                    //interval: 50,
                    axisLabel: {
                        formatter: '{value} 次'
                    }
                },
            ],
            series: [{
                name: '问题次数',
                type: 'bar',
                data: Y,
                itemStyle: { normal: { label: { show: true, position: 'top' } } }
            },
                {
                    name: '已完成数',
                    type: 'bar',
                    yAxisIndex: 0,
                    data: Y2,
                    itemStyle: { normal: { label: { show: true, position: 'top' } } }
                },
            ]
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    }





</script>
